Generalized dual-energy-window scatter compensation in spatially varying media for SPECT. The detection of scattered photons in the photopeak energy window hinders accurate activity estimation in single-photon-emission computed tomography (SPECT). To compensate for photons scattered in spatially varying media, a framework for generalized dual-energy-window scatter subtraction has been developed. Generalized scatter subtraction factors are introduced, and these factors are decomposed into terms dependent on the uniform (average) and spatially varying components of the source activity distribution. The variation of these factors with projection pixel location and gamma camera position is analysed for a simulated myocardial perfusion study with a 99Tc(m) source radionuclide and a non-uniform thorax model. Monte Carlo methods are used to model photon transport and detection. The application of pixel-dependent scatter subtraction factors for scatter compensation is evaluated in an image reconstruction experiment for this simulated myocardial perfusion study. Generalized matrix inverses with noise-dependent regularization are used for image reconstruction. For this simulation, use of a pixel-dependent scatter subtraction factor and a constant scatter subtraction factor are effective for scatter compensation. Activity estimates within the left ventricular myocardium for these two methods are practically the same as those obtained from image reconstructions where the detection of Compton-scattered photons is included in the system matrix.