Free energy balance for three fluid phases in a capillary of arbitrarily shaped cross-section: capillary entry pressures and layers of the intermediate-wetting phase. In this work we derive rigorously the free energy balance for three fluid phases in a straight capillary of arbitrarily shaped cross-section. This balance is then used to derive the general equation for the capillary entry pressures of all possible two-phase and three-phase displacements. Moreover, the equation provides the criterion determining the existence of layers of the intermediate-wetting phase separating the wetting and non-wetting phases in the corners or cavities of a capillary, by also treating the spreading of such layers as a capillary displacement. For a number of combinations of interfacial tensions and contact angles, illustrating all the different relevant situations, we calculate the criteria for spreading of such a layer in the corner of a capillary with polygonal cross-section. In a capillary with a cross-section in the shape of an isosceles triangle of varying corner size, these criteria are used to determine the unique capillary entry pressures for piston-like displacement from alternative solutions of the general equation. These solutions relate to displacements in the presence or absence of layers in the various differently sized corners.